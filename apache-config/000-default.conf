<VirtualHost *:80>
    DocumentRoot /var/www/html

    <Directory /var/www/html>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # Configuration des types MIME pour CSS et JS
    <FilesMatch "\.(css)$">
        SetEnvIf Request_URI "\.(css)$" no-gzip
        Header set Content-Type "text/css; charset=utf-8"
        Header set Cache-Control "max-age=31536000, public"
    </FilesMatch>

    <FilesMatch "\.(js)$">
        Header set Content-Type "application/javascript; charset=utf-8"
        Header set Cache-Control "max-age=31536000, public"
    </FilesMatch>

    # Configuration pour les vidéos - Support des requêtes de plage
    <FilesMatch "\.(mp4|webm|ogg|avi|mov)$">
        Header set Content-Type "video/mp4"
        Header set Accept-Ranges "bytes"
        Header set Cache-Control "max-age=3600, public"

        # Force l'activation du module mod_headers pour les requêtes de plage
        SetEnvIf Range "bytes=.*" RANGE_REQUEST
        Header set "Accept-Ranges" "bytes" env=RANGE_REQUEST
    </FilesMatch>

    <FilesMatch "\.(png|jpg|jpeg|gif|ico|svg)$">
        Header set Cache-Control "max-age=31536000, public"
    </FilesMatch>

    # Logs
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined

    # Support pour les URL propres
    <IfModule mod_rewrite.c>
        RewriteEngine On
        # Exclure les fichiers statiques du rewrite
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteCond %{REQUEST_URI} !\.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|mp4|webm|ogg|avi|mov)$ [NC]
        RewriteRule ^(.*)$ index.php/$1 [QSA,L]
    </IfModule>
</VirtualHost>